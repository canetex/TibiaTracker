# =============================================================================
# TIBIA TRACKER - CONFIGURAÇÃO CADDY
# =============================================================================
# Proxy reverso com SSL automático e headers de segurança

{
    admin off
    auto_https off
}

:8080 {
    # API - redirecionar para backend
    handle /api/* {
        reverse_proxy backend:8000
    }
    
    # Health check
    handle /health {
        reverse_proxy backend:8000
    }
    
    # Metrics
    handle /metrics {
        reverse_proxy backend:8000
    }
    
    # Frontend - todas as outras rotas
    handle /* {
        reverse_proxy frontend:80
    }
    
    # Headers de segurança
    header {
        # Proteção contra clickjacking
        X-Frame-Options SAMEORIGIN
        
        # Proteção contra MIME sniffing
        X-Content-Type-Options nosniff
        
        # Proteção XSS
        X-XSS-Protection "1; mode=block"
        
        # Política de referrer
        Referrer-Policy strict-origin-when-cross-origin
        
        # Política de permissões
        Permissions-Policy "geolocation=(), microphone=(), camera=()"
        
        # Remover header Server por segurança
        -Server
    }
    
    # Logs detalhados
    log {
        output file /var/log/caddy/access.log
        format json
    }
} 